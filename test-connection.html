<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNO Restaurant - Test Connection</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #dc2626;
            --secondary-color: #059669;
            --accent-color: #f59e0b;
            --neutral-color: #374151;
            --background-color: #f9fafb;
            --surface-color: #ffffff;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        body {
            background: linear-gradient(135deg, var(--background-color) 0%, #f3f4f6 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .test-container {
            background: var(--surface-color);
            border-radius: 1rem;
            padding: 3rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            max-width: 600px;
            width: 100%;
            margin: 2rem;
        }

        .test-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .test-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .test-subtitle {
            color: var(--text-secondary);
            font-size: 1.125rem;
        }

        .test-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--background-color);
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-icon {
            width: 2rem;
            height: 2rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .icon-config { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; }
        .icon-connection { background: linear-gradient(135deg, var(--secondary-color), #047857); color: white; }
        .icon-database { background: linear-gradient(135deg, var(--accent-color), #d97706); color: white; }
        .icon-realtime { background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; }

        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .config-item:last-child {
            border-bottom: none;
        }

        .config-label {
            font-weight: 500;
            color: var(--text-primary);
        }

        .config-value {
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            color: var(--text-secondary);
            background: var(--surface-color);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            border: 1px solid var(--border-color);
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        .status-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .status-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .status-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fed7aa;
        }

        .status-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }

        .status-dot {
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
        }

        .dot-success { background: #10b981; }
        .dot-error { background: #ef4444; }
        .dot-warning { background: #f59e0b; }
        .dot-info { background: #3b82f6; }

        .test-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 1rem;
        }

        .test-button:hover {
            background: #b91c1c;
            transform: translateY(-1px);
        }

        .test-button:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        .test-results {
            margin-top: 1rem;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 500;
        }

        .result-value {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .spinner {
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .back-button {
            position: fixed;
            top: 1rem;
            left: 1rem;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .back-button:hover {
            background: var(--background-color);
            color: var(--text-primary);
            box-shadow: var(--shadow-md);
        }

        .language-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
        }

        .btn-language {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .btn-language:hover {
            background: var(--background-color);
            box-shadow: var(--shadow-md);
        }

        @media (max-width: 768px) {
            .test-container {
                margin: 1rem;
                padding: 2rem;
            }

            .test-title {
                font-size: 1.5rem;
            }

            .config-value {
                max-width: 150px;
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Back Button -->
    <a href="./" class="back-button">
        <i class="bi bi-arrow-left"></i>
        <span data-en="Back" data-ar="رجوع">رجوع</span>
    </a>

    <!-- Language Toggle -->
    <div class="language-toggle">
        <button class="btn btn-language" onclick="toggleLanguage()">
            <i class="bi bi-translate"></i>
            <span id="languageText">English</span>
        </button>
    </div>

    <!-- Main Container -->
    <div class="test-container fade-in">
        <!-- Header -->
        <div class="test-header">
            <h1 class="test-title" data-en="Connection Test" data-ar="اختبار الاتصال">اختبار الاتصال</h1>
            <p class="test-subtitle" data-en="Verify Supabase database connectivity and configuration" data-ar="التحقق من اتصال قاعدة بيانات Supabase والتكوين">التحقق من اتصال قاعدة بيانات Supabase والتكوين</p>
        </div>

        <!-- Configuration Section -->
        <div class="test-section">
            <h2 class="section-title">
                <div class="section-icon icon-config">
                    <i class="bi bi-gear"></i>
                </div>
                <span data-en="Configuration" data-ar="التكوين">التكوين</span>
            </h2>
            
            <div class="config-item">
                <span class="config-label" data-en="Supabase URL" data-ar="رابط Supabase">رابط Supabase</span>
                <span class="config-value" id="supabaseUrl">Not configured</span>
            </div>
            
            <div class="config-item">
                <span class="config-label" data-en="Anonymous Key" data-ar="المفتاح المجهول">المفتاح المجهول</span>
                <span class="config-value" id="supabaseKey">Not configured</span>
            </div>
            
            <div class="config-item">
                <span class="config-label" data-en="Default Language" data-ar="اللغة الافتراضية">اللغة الافتراضية</span>
                <span class="config-value" id="defaultLanguage">Arabic</span>
            </div>
            
            <div class="config-item">
                <span class="config-label" data-en="Sound Alerts" data-ar="التنبيهات الصوتية">التنبيهات الصوتية</span>
                <span class="config-value" id="soundAlerts">Enabled</span>
            </div>
        </div>

        <!-- Connection Test Section -->
        <div class="test-section">
            <h2 class="section-title">
                <div class="section-icon icon-connection">
                    <i class="bi bi-wifi"></i>
                </div>
                <span data-en="Connection Status" data-ar="حالة الاتصال">حالة الاتصال</span>
            </h2>
            
            <div id="connectionStatus" class="status-indicator status-info">
                <div class="status-dot dot-info"></div>
                <span data-en="Ready to test connection" data-ar="جاهز لاختبار الاتصال">جاهز لاختبار الاتصال</span>
            </div>
            
            <button class="test-button" onclick="testConnection()" id="testButton">
                <span data-en="Test Connection" data-ar="اختبار الاتصال">اختبار الاتصال</span>
            </button>
        </div>

        <!-- Database Test Section -->
        <div class="test-section">
            <h2 class="section-title">
                <div class="section-icon icon-database">
                    <i class="bi bi-database"></i>
                </div>
                <span data-en="Database Operations" data-ar="عمليات قاعدة البيانات">عمليات قاعدة البيانات</span>
            </h2>
            
            <div id="databaseStatus" class="status-indicator status-info">
                <div class="status-dot dot-info"></div>
                <span data-en="Ready to test database operations" data-ar="جاهز لاختبار عمليات قاعدة البيانات">جاهز لاختبار عمليات قاعدة البيانات</span>
            </div>
            
            <button class="test-button" onclick="testDatabase()" id="databaseButton" disabled>
                <span data-en="Test Database" data-ar="اختبار قاعدة البيانات">اختبار قاعدة البيانات</span>
            </button>
            
            <div class="test-results" id="databaseResults" style="display: none;">
                <!-- Database test results will be shown here -->
            </div>
        </div>

        <!-- Real-time Test Section -->
        <div class="test-section">
            <h2 class="section-title">
                <div class="section-icon icon-realtime">
                    <i class="bi bi-broadcast"></i>
                </div>
                <span data-en="Real-time Features" data-ar="الميزات الفورية">الميزات الفورية</span>
            </h2>
            
            <div id="realtimeStatus" class="status-indicator status-info">
                <div class="status-dot dot-info"></div>
                <span data-en="Ready to test real-time subscriptions" data-ar="جاهز لاختبار الاشتراكات الفورية">جاهز لاختبار الاشتراكات الفورية</span>
            </div>
            
            <button class="test-button" onclick="testRealtime()" id="realtimeButton" disabled>
                <span data-en="Test Real-time" data-ar="اختبار الوقت الفعلي">اختبار الوقت الفعلي</span>
            </button>
            
            <div class="test-results" id="realtimeResults" style="display: none;">
                <!-- Real-time test results will be shown here -->
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Configuration -->
    <script src="config.js"></script>
    
    <!-- Supabase Client -->
    <script src="supabase/client.js"></script>

    <script>
        // Global variables
        let currentLanguage = Utils.getCurrentLanguage();
        let connectionTestPassed = false;
        let databaseTestPassed = false;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateLanguage();
            displayConfiguration();
        });

        // Language management
        function updateLanguage() {
            const elements = document.querySelectorAll('[data-en][data-ar]');
            elements.forEach(element => {
                const text = currentLanguage === 'en' ? element.dataset.en : element.dataset.ar;
                element.textContent = text;
            });

            document.getElementById('languageText').textContent = currentLanguage === 'en' ? 'العربية' : 'English';
            document.documentElement.dir = currentLanguage === 'ar' ? 'rtl' : 'ltr';
            document.documentElement.lang = currentLanguage;
        }

        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'ar' : 'en';
            Utils.setLanguage(currentLanguage);
            updateLanguage();
        }

        // Display configuration
        function displayConfiguration() {
            // Supabase URL
            const supabaseUrl = SUPABASE_CONFIG.url;
            document.getElementById('supabaseUrl').textContent = 
                supabaseUrl.includes('YOUR_SUPABASE_URL') ? 'Not configured' : 
                supabaseUrl.length > 30 ? supabaseUrl.substring(0, 30) + '...' : supabaseUrl;

            // Supabase Key
            const supabaseKey = SUPABASE_CONFIG.anonKey;
            document.getElementById('supabaseKey').textContent = 
                supabaseKey.includes('YOUR_SUPABASE_ANON_KEY') ? 'Not configured' : 
                supabaseKey.substring(0, 20) + '...';

            // Default Language
            document.getElementById('defaultLanguage').textContent = 
                APP_CONFIG.defaultLanguage === 'ar' ? 'Arabic' : 'English';

            // Sound Alerts
            document.getElementById('soundAlerts').textContent = 
                APP_CONFIG.features.enableSoundAlerts ? 'Enabled' : 'Disabled';
        }

        // Connection test
        async function testConnection() {
            const button = document.getElementById('testButton');
            const status = document.getElementById('connectionStatus');
            
            // Update button state
            button.disabled = true;
            button.innerHTML = `
                <div class="spinner"></div>
                <span data-en="Testing..." data-ar="جاري الاختبار...">${currentLanguage === 'en' ? 'Testing...' : 'جاري الاختبار...'}</span>
            `;

            // Update status to testing
            status.className = 'status-indicator status-info';
            status.innerHTML = `
                <div class="status-dot dot-info"></div>
                <span data-en="Testing connection..." data-ar="جاري اختبار الاتصال...">${currentLanguage === 'en' ? 'Testing connection...' : 'جاري اختبار الاتصال...'}</span>
            `;

            try {
                // Test Supabase client initialization
                if (!supabaseClient.isReady()) {
                    throw new Error('Supabase client not initialized');
                }

                // Test connection
                const result = await supabaseClient.testConnection();
                
                if (result.success) {
                    // Success
                    status.className = 'status-indicator status-success';
                    status.innerHTML = `
                        <div class="status-dot dot-success"></div>
                        <span data-en="Connection successful!" data-ar="نجح الاتصال!">${currentLanguage === 'en' ? 'Connection successful!' : 'نجح الاتصال!'}</span>
                    `;
                    
                    connectionTestPassed = true;
                    document.getElementById('databaseButton').disabled = false;
                    
                } else {
                    throw new Error(result.message || 'Connection failed');
                }

            } catch (error) {
                console.error('Connection test failed:', error);
                
                // Error
                status.className = 'status-indicator status-error';
                status.innerHTML = `
                    <div class="status-dot dot-error"></div>
                    <span data-en="Connection failed: ${error.message}" data-ar="فشل الاتصال: ${error.message}">${currentLanguage === 'en' ? 'Connection failed' : 'فشل الاتصال'}: ${error.message}</span>
                `;
                
                connectionTestPassed = false;
            } finally {
                // Reset button
                button.disabled = false;
                button.innerHTML = `
                    <span data-en="Test Connection" data-ar="اختبار الاتصال">${currentLanguage === 'en' ? 'Test Connection' : 'اختبار الاتصال'}</span>
                `;
            }
        }

        // Database test
        async function testDatabase() {
            const button = document.getElementById('databaseButton');
            const status = document.getElementById('databaseStatus');
            const results = document.getElementById('databaseResults');
            
            // Update button state
            button.disabled = true;
            button.innerHTML = `
                <div class="spinner"></div>
                <span data-en="Testing..." data-ar="جاري الاختبار...">${currentLanguage === 'en' ? 'Testing...' : 'جاري الاختبار...'}</span>
            `;

            // Update status to testing
            status.className = 'status-indicator status-info';
            status.innerHTML = `
                <div class="status-dot dot-info"></div>
                <span data-en="Testing database operations..." data-ar="جاري اختبار عمليات قاعدة البيانات...">${currentLanguage === 'en' ? 'Testing database operations...' : 'جاري اختبار عمليات قاعدة البيانات...'}</span>
            `;

            const testResults = [];

            try {
                // Test 1: Read categories
                try {
                    const categories = await supabaseClient.getCategories();
                    testResults.push({
                        test: currentLanguage === 'en' ? 'Read Categories' : 'قراءة الفئات',
                        result: currentLanguage === 'en' ? `Found ${categories.length} categories` : `تم العثور على ${categories.length} فئة`,
                        success: true
                    });
                } catch (error) {
                    testResults.push({
                        test: currentLanguage === 'en' ? 'Read Categories' : 'قراءة الفئات',
                        result: error.message,
                        success: false
                    });
                }

                // Test 2: Read tables
                try {
                    const tables = await supabaseClient.getTables();
                    testResults.push({
                        test: currentLanguage === 'en' ? 'Read Tables' : 'قراءة الطاولات',
                        result: currentLanguage === 'en' ? `Found ${tables.length} tables` : `تم العثور على ${tables.length} طاولة`,
                        success: true
                    });
                } catch (error) {
                    testResults.push({
                        test: currentLanguage === 'en' ? 'Read Tables' : 'قراءة الطاولات',
                        result: error.message,
                        success: false
                    });
                }

                // Test 3: Read quick actions
                try {
                    const quickActions = await supabaseClient.getQuickActions();
                    testResults.push({
                        test: currentLanguage === 'en' ? 'Read Quick Actions' : 'قراءة الإجراءات السريعة',
                        result: currentLanguage === 'en' ? `Found ${quickActions.length} actions` : `تم العثور على ${quickActions.length} إجراء`,
                        success: true
                    });
                } catch (error) {
                    testResults.push({
                        test: currentLanguage === 'en' ? 'Read Quick Actions' : 'قراءة الإجراءات السريعة',
                        result: error.message,
                        success: false
                    });
                }

                // Test 4: Read menu items
                try {
                    const menuItems = await supabaseClient.getAllMenuItems();
                    testResults.push({
                        test: currentLanguage === 'en' ? 'Read Menu Items' : 'قراءة عناصر القائمة',
                        result: currentLanguage === 'en' ? `Found ${menuItems.length} items` : `تم العثور على ${menuItems.length} عنصر`,
                        success: true
                    });
                } catch (error) {
                    testResults.push({
                        test: currentLanguage === 'en' ? 'Read Menu Items' : 'قراءة عناصر القائمة',
                        result: error.message,
                        success: false
                    });
                }

                // Check if all tests passed
                const allTestsPassed = testResults.every(test => test.success);
                
                if (allTestsPassed) {
                    status.className = 'status-indicator status-success';
                    status.innerHTML = `
                        <div class="status-dot dot-success"></div>
                        <span data-en="All database tests passed!" data-ar="نجحت جميع اختبارات قاعدة البيانات!">${currentLanguage === 'en' ? 'All database tests passed!' : 'نجحت جميع اختبارات قاعدة البيانات!'}</span>
                    `;
                    
                    databaseTestPassed = true;
                    document.getElementById('realtimeButton').disabled = false;
                } else {
                    status.className = 'status-indicator status-warning';
                    status.innerHTML = `
                        <div class="status-dot dot-warning"></div>
                        <span data-en="Some database tests failed" data-ar="فشلت بعض اختبارات قاعدة البيانات">${currentLanguage === 'en' ? 'Some database tests failed' : 'فشلت بعض اختبارات قاعدة البيانات'}</span>
                    `;
                }

            } catch (error) {
                console.error('Database test failed:', error);
                
                status.className = 'status-indicator status-error';
                status.innerHTML = `
                    <div class="status-dot dot-error"></div>
                    <span data-en="Database test failed: ${error.message}" data-ar="فشل اختبار قاعدة البيانات: ${error.message}">${currentLanguage === 'en' ? 'Database test failed' : 'فشل اختبار قاعدة البيانات'}: ${error.message}</span>
                `;
            } finally {
                // Show results
                results.style.display = 'block';
                results.innerHTML = testResults.map(test => `
                    <div class="result-item">
                        <span class="result-label">
                            <i class="bi bi-${test.success ? 'check-circle text-success' : 'x-circle text-danger'}"></i>
                            ${test.test}
                        </span>
                        <span class="result-value">${test.result}</span>
                    </div>
                `).join('');

                // Reset button
                button.disabled = false;
                button.innerHTML = `
                    <span data-en="Test Database" data-ar="اختبار قاعدة البيانات">${currentLanguage === 'en' ? 'Test Database' : 'اختبار قاعدة البيانات'}</span>
                `;
            }
        }

        // Real-time test
        async function testRealtime() {
            const button = document.getElementById('realtimeButton');
            const status = document.getElementById('realtimeStatus');
            const results = document.getElementById('realtimeResults');
            
            // Update button state
            button.disabled = true;
            button.innerHTML = `
                <div class="spinner"></div>
                <span data-en="Testing..." data-ar="جاري الاختبار...">${currentLanguage === 'en' ? 'Testing...' : 'جاري الاختبار...'}</span>
            `;

            // Update status to testing
            status.className = 'status-indicator status-info';
            status.innerHTML = `
                <div class="status-dot dot-info"></div>
                <span data-en="Testing real-time subscriptions..." data-ar="جاري اختبار الاشتراكات الفورية...">${currentLanguage === 'en' ? 'Testing real-time subscriptions...' : 'جاري اختبار الاشتراكات الفورية...'}</span>
            `;

            const testResults = [];

            try {
                // Test 1: Subscribe to orders
                try {
                    const subscription = supabaseClient.subscribeToAllOrders((payload) => {
                        console.log('Real-time order update:', payload);
                    });
                    
                    testResults.push({
                        test: currentLanguage === 'en' ? 'Orders Subscription' : 'اشتراك الطلبات',
                        result: currentLanguage === 'en' ? 'Successfully subscribed' : 'تم الاشتراك بنجاح',
                        success: true
                    });

                    // Unsubscribe after test
                    setTimeout(() => {
                        if (subscription && subscription.unsubscribe) {
                            subscription.unsubscribe();
                        }
                    }, 1000);

                } catch (error) {
                    testResults.push({
                        test: currentLanguage === 'en' ? 'Orders Subscription' : 'اشتراك الطلبات',
                        result: error.message,
                        success: false
                    });
                }

                // Test 2: Subscribe to quick actions
                try {
                    const subscription = supabaseClient.subscribeToAllQuickActionRequests((payload) => {
                        console.log('Real-time quick action update:', payload);
                    });
                    
                    testResults.push({
                        test: currentLanguage === 'en' ? 'Quick Actions Subscription' : 'اشتراك الإجراءات السريعة',
                        result: currentLanguage === 'en' ? 'Successfully subscribed' : 'تم الاشتراك بنجاح',
                        success: true
                    });

                    // Unsubscribe after test
                    setTimeout(() => {
                        if (subscription && subscription.unsubscribe) {
                            subscription.unsubscribe();
                        }
                    }, 1000);

                } catch (error) {
                    testResults.push({
                        test: currentLanguage === 'en' ? 'Quick Actions Subscription' : 'اشتراك الإجراءات السريعة',
                        result: error.message,
                        success: false
                    });
                }

                // Check if all tests passed
                const allTestsPassed = testResults.every(test => test.success);
                
                if (allTestsPassed) {
                    status.className = 'status-indicator status-success';
                    status.innerHTML = `
                        <div class="status-dot dot-success"></div>
                        <span data-en="Real-time features working!" data-ar="الميزات الفورية تعمل!">${currentLanguage === 'en' ? 'Real-time features working!' : 'الميزات الفورية تعمل!'}</span>
                    `;
                } else {
                    status.className = 'status-indicator status-warning';
                    status.innerHTML = `
                        <div class="status-dot dot-warning"></div>
                        <span data-en="Some real-time tests failed" data-ar="فشلت بعض اختبارات الوقت الفعلي">${currentLanguage === 'en' ? 'Some real-time tests failed' : 'فشلت بعض اختبارات الوقت الفعلي'}</span>
                    `;
                }

            } catch (error) {
                console.error('Real-time test failed:', error);
                
                status.className = 'status-indicator status-error';
                status.innerHTML = `
                    <div class="status-dot dot-error"></div>
                    <span data-en="Real-time test failed: ${error.message}" data-ar="فشل اختبار الوقت الفعلي: ${error.message}">${currentLanguage === 'en' ? 'Real-time test failed' : 'فشل اختبار الوقت الفعلي'}: ${error.message}</span>
                `;
            } finally {
                // Show results
                results.style.display = 'block';
                results.innerHTML = testResults.map(test => `
                    <div class="result-item">
                        <span class="result-label">
                            <i class="bi bi-${test.success ? 'check-circle text-success' : 'x-circle text-danger'}"></i>
                            ${test.test}
                        </span>
                        <span class="result-value">${test.result}</span>
                    </div>
                `).join('');

                // Reset button
                button.disabled = false;
                button.innerHTML = `
                    <span data-en="Test Real-time" data-ar="اختبار الوقت الفعلي">${currentLanguage === 'en' ? 'Test Real-time' : 'اختبار الوقت الفعلي'}</span>
                `;
            }
        }
    </script>
</body>
</html>

